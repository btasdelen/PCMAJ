DATAIN	BIT P1.0
CS	BIT P1.1
IOCLK	BIT P1.2
ADDRESS	BIT P1.3
EOC	BIT P1.4

ADC_PORT EQU P1

ORG 0
LJMP MAIN

MAIN:
	SETB CS
	CLR IOCLK

	ACALL GET_DATA

GET_DATA:
	MOV R0, #10
	MOV R1, #50h
	MOV A, #10h	; 0001 channel for x axis

	CLR CS
SEND_X:
	RLC A
	MOV ADDRESS, C

	SETB IOCLK

	NOP
	NOP

	CLR IOCLK

	DJNZ R0, SEND_X
	;END OF ADDRESSING X
	SETB CS

	JB EOC, $
	MOV R0, #10
	MOV A, #20h	; 0010 cHAnnel for y axis
	JNB EOC, $		; WAIT FOR RISING EDGE OF EOC

	CLR CS
TAKE_X_SEND_Y:
	RLC A
	MOV ADDRESS, C

	SETB IOCLK

	MOV @R1, ADC_PORT
	INC R1

	CLR IOCLK

	DJNZ R0, TAKE_X_SEND_Y
	;END OF TAKING X, ADDRESSING Y
	SETB CS

	JB EOC, $
	MOV R0, #10
	JNB EOC, $	; WAIT FOR RISING EDGE OF EOC

	CLR CS

TAKE_Y:
	NOP
	NOP

	SETB IOCLK

	MOV @R1, ADC_PORT
	INC R1

	CLR IOCLK

	DJNZ R0, TAKE_Y

	SETB CS

	RET
END
